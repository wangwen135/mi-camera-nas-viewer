# 小米摄像头 NAS 视频查看工具

## 项目简介

这是一个用于查看存储在 NAS 服务器上的小米摄像头录像的 Web 应用工具。

## 功能特性

- ✅ 摄像头列表配置（通过配置文件）
- ✅ 按日期/小时/分钟浏览视频
- ✅ 视频在线播放（支持多种控制）
- ✅ 视频下载功能
- ✅ 播放速度控制（0.25x - 16x）
- ✅ 逐帧播放（鼠标滚轮）
- ✅ 自动播放下一个视频
- ✅ 画面放大/缩小
- 🔐 访问密码保护
- 🔐 IP 地址锁定机制
- 🔐 Session 会话管理

## 技术栈

- **后端**: Spring Boot 2.4.13
- **前端**: Bootstrap 5 + jQuery
- **JDK**: 1.8+

## 快速开始

### 1. 修改配置

编辑 `src/main/resources/application.yml` 文件，配置以下内容：

```yaml
# 摄像头视频配置
camera:
  # 视频文件存储基础路径（NAS 路径）
  base-path: H:\监控\xiaomi_camera_videos

  # 摄像头列表配置
  cameras:
    - name: 门口摄像头
      code: 0_12345678
      enabled: true
    - name: 客厅摄像头
      code: 1_87654321
      enabled: true

# 安全配置
security:
  # 访问密码（请修改为强密码）
  password: admin123
  # Session 过期时间（秒），默认30分钟
  session-timeout: 1800
  # 最大登录失败次数
  max-fail-count: 3
  # IP 锁定时间（秒），默认10分钟
  lock-time: 600
```

**⚠️ 安全提示**：
- 首次使用请务必修改默认密码
- 建议使用强密码（包含大小写字母、数字、特殊字符）
- 定期更换密码以提高安全性

### 2. 编译运行

```bash
# 编译项目
mvn clean package

# 运行项目
java -jar target/mi-camera-nas-viewer-1.0.0.jar
```

或者在 IDE 中直接运行 `MiCameraNasViewerApplication` 主类。

### 3. 访问应用

1. 打开浏览器访问：`http://localhost:8866`
2. 首次访问会跳转到登录页面
3. 输入配置的密码进行登录
4. 登录成功后即可使用视频查看功能
5. Session 有效期为 30 分钟，超时需要重新登录

## 安全特性

### 访问控制
- 所有页面和接口都需要登录认证
- 基于 Session 的身份验证机制
- 登录状态保持 30 分钟（可配置）

### IP 锁定机制
- 连续输入错误密码 **3 次**，IP 将被锁定
- 锁定时长为 **10 分钟**（可配置）
- 锁定期间该 IP 无法访问系统
- 登录成功后自动重置失败计数

### 安全建议
1. 使用强密码（建议 12 位以上，包含大小写字母、数字、特殊字符）
2. 定期更换访问密码
3. 不要在公网环境下直接暴露服务
4. 建议配合 VPN 或防火墙使用
5. 生产环境建议使用 HTTPS

## 视频文件结构

视频文件需要按照以下目录结构存储：

```
H:\监控\xiaomi_camera_videos\          # 基础路径
├── 0_12345678\                         # 摄像头代码
│   ├── 2022121817\                     # 日期+小时（yyyyMMddHH）
│   │   ├── 202212181738.mp4           # 日期时间+分钟.mp4
│   │   ├── 202212181739.mp4
│   │   └── ...
│   └── 2022121818\
│       └── ...
└── 1_87654321\
    └── ...
```

## 获取摄像头代码

摄像头代码可以在小米摄像头的 NAS 存储目录中找到，格式通常为：
- `0_XXXXXXXX`（第一台摄像头）
- `1_XXXXXXXX`（第二台摄像头）

## API 接口

### 认证相关

| 接口 | 方法 | 说明 | 是否需要登录 |
|------|------|------|-------------|
| `/auth/login` | GET/POST | 登录页面/登录接口 | 否 |
| `/auth/logout` | POST | 退出登录 | 是 |
| `/auth/check` | GET | 检查登录状态 | 否 |

### 摄像头视频相关

| 接口 | 方法 | 说明 | 是否需要登录 |
|------|------|------|-------------|
| `/camera/list` | GET | 获取摄像头列表 | 是 |
| `/camera/video/date` | GET | 获取有视频的日期列表 | 是 |
| `/camera/video/hour` | GET | 获取指定日期的小时列表 | 是 |
| `/camera/video/minute` | GET | 获取指定小时的分钟列表 | 是 |
| `/camera/video/{code}/{date}-{hour}-{minute}.mp4` | GET | 播放/下载视频 | 是 |

> 所有接口（除登录相关）都需要通过身份认证才能访问，未登录请求将返回 401 或重定向到登录页。

## 播放器控制

- **播放/暂停**: 点击播放按钮
- **跳转**: 在时间输入框输入秒数，点击跳转按钮
- **逐帧**: 鼠标滚轮在时间输入框上下滚动
- **放大/缩小**: 点击放大/缩小按钮
- **播放速度**: 点击快放/慢放/正常按钮
- **下载**: 点击下载按钮

## 注意事项

1. 确保 NAS 视频路径有正确的读取权限
2. 视频文件名格式必须严格按照 `yyyyMMddHHmm.mp4` 格式
3. H.265 编码的视频需要较新版本的浏览器支持
4. 建议使用 Chrome、Edge、Firefox 等现代浏览器

## 故障排除

### 无法登录
- 检查密码是否正确（区分大小写）
- 如 IP 被锁定，请等待 10 分钟后重试
- 清除浏览器 Cookie 后重试

### 视频无法播放
- 检查视频文件路径是否正确
- 确认视频文件格式为 MP4（H.264/H.265）
- 尝试更换浏览器（推荐 Chrome）
- 检查浏览器控制台是否有错误信息

### 找不到视频文件
- 确认 NAS 路径配置正确
- 检查文件命名格式是否符合要求
- 确认文件读取权限设置正确

## 端口配置

默认端口为 `8866`，可在 `application.yml` 中修改：

```yaml
server:
  port: 8866
```

## 许可证

MIT License
